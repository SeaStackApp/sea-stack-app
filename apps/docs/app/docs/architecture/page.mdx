import { Callout } from '@/components/callout'

# Architecture Overview

SeaStack is built as a modern monorepo using cutting-edge web technologies. This architecture provides excellent developer experience, type safety, and maintainability.

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────┐
│                      Web Browser                         │
└───────────────────────┬─────────────────────────────────┘
                        │
                        │ HTTPS
                        │
┌───────────────────────▼─────────────────────────────────┐
│                   Next.js App (apps/web)                 │
│  ┌─────────────┐  ┌──────────┐  ┌─────────────────┐   │
│  │   React UI  │  │  tRPC    │  │  Better Auth    │   │
│  │             │◄─┤  API     │  │                 │   │
│  └─────────────┘  └────┬─────┘  └────────┬────────┘   │
└────────────────────────┼─────────────────┼─────────────┘
                         │                  │
                    ┌────▼────┐        ┌───▼────┐
                    │ Prisma  │        │  Auth  │
                    │ Client  │        │  Utils │
                    └────┬────┘        └────────┘
                         │
                    ┌────▼────────────────────┐
                    │   PostgreSQL Database    │
                    └─────────────────────────┘
```

## Technology Stack

### Frontend

- **Next.js 16**: React framework with App Router for server-side rendering and routing
- **React 19**: Latest React for building the user interface
- **Tailwind CSS 4**: Utility-first CSS framework for styling
- **Radix UI**: Unstyled, accessible UI components
- **Lucide React**: Beautiful icon set

### Backend

- **tRPC**: End-to-end type-safe APIs without code generation
- **Prisma**: Type-safe database ORM
- **PostgreSQL**: Reliable, powerful relational database
- **Better Auth**: Modern authentication solution

### Development Tools

- **Turborepo**: High-performance build system for monorepos
- **TypeScript**: Type safety across the entire stack
- **ESLint**: Code linting and quality checks
- **Prettier**: Code formatting

## Core Principles

### Type Safety

SeaStack uses TypeScript throughout the entire stack. Combined with tRPC, this provides end-to-end type safety from the database to the UI:

```typescript
// Define your schema
const userRouter = router({
    getUser: publicProcedure
        .input(z.object({ id: z.string() }))
        .query(async ({ input }) => {
            return await prisma.user.findUnique({
                where: { id: input.id }
            })
        })
})

// Use it in your component with full type safety
const user = trpc.getUser.useQuery({ id: userId })
```

### Monorepo Structure

The project is organized as a monorepo with shared packages:

- Reduces code duplication
- Ensures consistency across the application
- Simplifies dependency management
- Enables atomic commits across multiple packages

### Security First

Security is a top priority:

- SSH keys are encrypted at rest using AES-256
- Passwords are hashed using bcrypt
- Environment variables for sensitive data
- HTTPS in production

<Callout type="note" title="Encryption Keys">
The `ENCRYPTION_SECRET` environment variable is used to encrypt SSH private keys before storing them in the database. This ensures that even if the database is compromised, the keys remain secure.
</Callout>

## Data Flow

### User Authentication

1. User submits credentials via login form
2. Better Auth validates credentials
3. Session token is created and stored
4. Client receives session cookie
5. Subsequent requests include session token

### Server Management

1. User adds server details (hostname, SSH key)
2. SSH key is encrypted before storage
3. When connecting, key is decrypted in memory
4. SSH connection is established
5. Commands are executed on remote server
6. Results are streamed back to the client

### Future: Container Deployment

1. User defines application stack
2. Stack configuration is validated
3. Deployment job is queued
4. Worker picks up job
5. Docker Swarm receives deployment
6. Traefik routes traffic to new containers

## Next Steps

Learn more about specific aspects of the architecture:

- [Monorepo Structure](/docs/architecture/monorepo) - Detailed breakdown of the monorepo
- [Tech Stack](/docs/architecture/tech-stack) - In-depth look at each technology
