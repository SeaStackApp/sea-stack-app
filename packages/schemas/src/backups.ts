import { z } from 'zod';
import { volumeIdSchema } from './volumes';

export const cron6Regex =
    /^(?:\*|(?:[0-5]?\d)(?:-[0-5]?\d)?(?:\/[0-5]?\d)?(?:,(?:[0-5]?\d)(?:-[0-5]?\d)?(?:\/[0-5]?\d)?)*)\s+(?:\*|(?:[0-5]?\d)(?:-[0-5]?\d)?(?:\/[0-5]?\d)?(?:,(?:[0-5]?\d)(?:-[0-5]?\d)?(?:\/[0-5]?\d)?)*)\s+(?:\*|(?:[01]?\d|2[0-3])(?:-(?:[01]?\d|2[0-3]))?(?:\/(?:[01]?\d|2[0-3]))?(?:,(?:[01]?\d|2[0-3])(?:-(?:[01]?\d|2[0-3]))?(?:\/(?:[01]?\d|2[0-3]))?)*)\s+(?:\*|(?:0?[1-9]|[12]\d|3[01])(?:-(?:0?[1-9]|[12]\d|3[01]))?(?:\/(?:0?[1-9]|[12]\d|3[01]))?(?:,(?:0?[1-9]|[12]\d|3[01])(?:-(?:0?[1-9]|[12]\d|3[01]))?(?:\/(?:0?[1-9]|[12]\d|3[01]))?)*)\s+(?:\*|(?:0?[1-9]|1[0-2])(?:-(?:0?[1-9]|1[0-2]))?(?:\/(?:0?[1-9]|1[0-2]))?(?:,(?:0?[1-9]|1[0-2])(?:-(?:0?[1-9]|1[0-2]))?(?:\/(?:0?[1-9]|1[0-2]))?)*)\s+(?:\*|[0-6](?:-[0-6])?(?:\/[0-6])?(?:,(?:[0-6](?:-[0-6])?(?:\/[0-6])?))*)$/;

export const retentionRegex =
    /^\s*(?:@(?:latest|days|weeks|months|years):[1-9]([0-9]*)\s*)*$/;

export const volumeBackupScheduleCreateSchema = volumeIdSchema.extend({
    cron: z.string().regex(cron6Regex),
    retention: z.string().regex(retentionRegex).optional(),
    storageDestinationId: z.string(),
});
